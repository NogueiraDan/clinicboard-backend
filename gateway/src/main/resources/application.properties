spring.application.name=gateway
server.port=8080

# Routes Properties
spring.cloud.gateway.server.webflux.discovery.locator.enabled=false
spring.cloud.gateway.server.webflux.discovery.locator.lower-case-service-id=false

# Eureka Client Properties
eureka.client.serviceUrl.defaultZone=${EUREKA_CLIENT_SERVICEURL_DEFAULTZONE:http://localhost:8761/eureka/}
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true
eureka.client.should-enforce-registration-at-init=true
eureka.client.registryFetchIntervalSeconds=10
eureka.instance.lease-renewal-interval-in-seconds=10
eureka.instance.lease-expiration-duration-in-seconds=20
eureka.client.healthcheck.enabled=true
eureka.client.eureka-server-connect-timeout-seconds=5
eureka.client.eureka-server-read-timeout-seconds=8

# Redis Configuration (Corrigido)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# JWT Configuration (Corrigido - mesmo secret do user-service)
api.security.token.secret=${JWT_SECRET:clinicboard-token-secret-key}

# User Service Configuration
app.services.user-service.url=${USER_SERVICE_URL:http://user-service:8081}

# Cache TTL Configuration
app.cache.user-info.ttl=${CACHE_TTL:3600}

# ===== CONFIGURAÇÃO DE TRACING CORRIGIDA =====
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=${ZIPKIN_URL:http://zipkin:9411}/api/v2/spans
management.endpoints.web.exposure.include=health,info,metrics,prometheus,traces
management.endpoint.health.show-details=always
management.metrics.tags.application=${spring.application.name}
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# Logs com Trace ID
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]

# Tracing adicional para WebFlux
spring.sleuth.zipkin.base-url=${ZIPKIN_URL:http://zipkin:9411}
spring.sleuth.sampler.probability=1.0